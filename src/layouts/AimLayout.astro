---
// src/layouts/AimLayout.astro
import BaseLayout from './BaseLayout.astro';
import AimNavigation from '../components/AimNavigation.astro';

// The aimNumber is passed from the frontmatter of the .md file
const { frontmatter } = Astro.props;
const { aimNumber } = frontmatter;
---
<BaseLayout>
    <slot />
    <AimNavigation aimNumber={aimNumber} />

    <style>
        .code-block-container {
            position: relative;
            margin-bottom: 1rem; /* Adjust as needed */
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #333;
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .copy-button:hover {
            opacity: 1;
        }
    </style>

    <script is:inline>
        document.addEventListener('DOMContentLoaded', () => {
            const codeBlocks = document.querySelectorAll('pre code');

            codeBlocks.forEach(codeBlock => {
                const pre = codeBlock.parentNode;
                if (pre.tagName === 'PRE') {
                    const container = document.createElement('div');
                    container.classList.add('code-block-container');
                    pre.parentNode.insertBefore(container, pre);
                    container.appendChild(pre);

                    const copyButton = document.createElement('button');
                    copyButton.classList.add('copy-button');
                    copyButton.textContent = 'Copy';
                    container.appendChild(copyButton);

                    copyButton.addEventListener('click', () => {
                        const codeToCopy = codeBlock.textContent;
                        navigator.clipboard.writeText(codeToCopy).then(() => {
                            copyButton.textContent = 'Copied!';
                            setTimeout(() => {
                                copyButton.textContent = 'Copy';
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy: ', err);
                        });
                    });
                }
            });
        });
    </script>
</BaseLayout>
